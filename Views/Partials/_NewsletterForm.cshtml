@model NRRC_External_2025.ViewModel.NewsLetterModel
@using NRRC_External_2025.Resources
@inject Umbraco.Cms.Core.Web.IUmbracoContextAccessor _contextAccessor

@{
    bool IsArabic = true;
    if (_contextAccessor.TryGetUmbracoContext(out var context))
    {
        var culture = context.PublishedRequest?.Culture?.ToLower() ?? "";
        if (culture.Contains("en"))
        {
            IsArabic = false;
        }
    }

}

<form asp-action="InsertNewsLetterMail" asp-controller="NewsLetter"
      data-ajax="true" data-ajax-method="POST"
      data-ajax-success="OnSuccess">

    @Html.AntiForgeryToken()

    <!-- Success Alert -->
    <!-- Main Form -->
    <div class="py-5 bg-green-light">
        <div class="px-0 px-xl-5 py-5">
            <div class="container-fluid">

                <section class="section-bottom" style="display:none" id="SuccessSection">
                    <div class="alert alert-success text-center emptyItems" style="margin-bottom:50px;" role="alert">
                        <h5 style="color:#15a768 !important;line-height:1.5 !important;margin-bottom:0px;">

                            @(IsArabic ? " تم الاشتراك فى النشرة البريدية بنجاح" : "You have successfully subscribed to the newsletter.")
                            
                        </h5>
                    </div>
                </section>

                <!-- Failure Alert -->
                <section class="section-bottom" style="display:none" id="FailSection">
                    <div class="alert alert-danger text-center emptyItems" style="margin-bottom:50px;" role="alert">
                        <h5 style="color:red !important;line-height:1.5 !important;margin-bottom:0px;">
                           

                            @(IsArabic ? "عفوا ، تم التسجيل بنفس البريد مسبقا" : "Sorry, you have already registered with the same email.")


                        </h5>
                    </div>
                </section>
                <div id="formSection">
                    <div class="service-item border bg-white rounded-4 p-3 d-flex flex-column align-items-start">
                        <div class="icon bg-green-50 rounded-circle d-flex align-items-center justify-content-center mb-4">
                            <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M15.5529 8.5068C15.8328 8.20146 15.8121 7.72703 15.5068 7.44714C15.2015 7.16724 14.727 7.18787 14.4471 7.49321L9.47644 12.9158L7.53033 10.9697C7.23744 10.6768 6.76256 10.6768 6.46967 10.9697C6.17678 11.2626 6.17678 11.7374 6.46967 12.0303L8.96967 14.5303C9.11432 14.675 9.31178 14.7543 9.51629 14.7498C9.72081 14.7454 9.91464 14.6576 10.0529 14.5068L15.5529 8.5068Z" fill="#067647" />
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M11 21.75C5.06294 21.75 0.25 16.9371 0.25 11C0.25 5.06294 5.06294 0.25 11 0.25C16.9371 0.25 21.75 5.06294 21.75 11C21.75 16.9371 16.9371 21.75 11 21.75ZM1.75 11C1.75 16.1086 5.89137 20.25 11 20.25C16.1086 20.25 20.25 16.1086 20.25 11C20.25 5.89137 16.1086 1.75 11 1.75C5.89137 1.75 1.75 5.89137 1.75 11Z" fill="#067647" />
                            </svg>
                        </div>
                        <h5 class="font-bold mb-3">
                            @(IsArabic ? " النشرة البريدية" : "Newsletter")

                           
                        </h5>

                        <div class="d-flex gap-3 align-items-center mb-3">
                            <div class="inner-search-box border px-3 py-2 d-flex align-items-center gap-3 flex-grow-1 rounded-2">
                                <div class="icon" style="width:auto;height:auto">
                                    <img src="/images/envelope-green-icon.svg" alt="Email Icon">
                                </div>
                                <div class="flex-grow-1">
                                    <input asp-for="Email" class="border-0 bg-transparent w-100 NewslettertxtEmail" placeholder="@(IsArabic ? "أدخل البريد الإلكتروني" : "Enter your email")" maxlength="245" />
                                </div>
                            </div>

                            <input type="submit" value="@(IsArabic ? "اشترك" : "Subscribe")" class="bg-green text-white p-3 py-2 btn" />
                        </div>

                        <span asp-validation-for="Email" class="text-danger"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<!-- Scripts (include once per page) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajax-unobtrusive/3.2.6/jquery.unobtrusive-ajax.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.1/jquery.validate.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.11/jquery.validate.unobtrusive.min.js"></script>

<script>
    function OnSuccess(response) {
        if (response.success === true) {
            $("#SuccessSection").show();
            $("#FailSection").hide();
            $("#formSection").hide();
        } else {
            $("#SuccessSection").hide();
            $("#FailSection").show();
            $("#formSection").show();
        }
    }
</script>
